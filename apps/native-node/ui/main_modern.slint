import { Button, StandardButton, LineEdit, TextEdit, VerticalBox, HorizontalBox, ScrollView, GridBox, GroupBox, StandardListView, ListView, ComboBox } from "std-widgets.slint";

export global AppState {
    in-out property <bool> websocket-connected: false;
    in-out property <string> device-id: "";
    in-out property <string> session-status: "No active session";
    in-out property <string> generated-address: "";
    in-out property <[string]> log-messages: [];
}

export component MainWindow inherits Window {
    title: "MPC Wallet - Native Node";
    preferred-width: 1000px;
    preferred-height: 700px;
    min-width: 800px;
    min-height: 600px;
    
    // Dark theme colors
    property <color> bg-primary: #1a1f2e;
    property <color> bg-secondary: #242937;
    property <color> bg-tertiary: #2d3548;
    property <color> text-primary: #e4e7f1;
    property <color> text-secondary: #a3abc2;
    property <color> accent-primary: #4a9eff;
    property <color> accent-success: #4ade80;
    property <color> accent-error: #ef4444;
    property <color> border-color: #3a4052;
    
    callback connect-websocket(string);
    callback start-dkg();
    
    background: bg-primary;
    
    VerticalBox {
        padding: 20px;
        spacing: 20px;
        
        // Header
        Rectangle {
            height: 80px;
            background: bg-secondary;
            border-radius: 12px;
            drop-shadow-blur: 20px;
            drop-shadow-color: rgba(0, 0, 0, 0.3);
            
            HorizontalBox {
                padding: 20px;
                alignment: space-between;
                
                VerticalBox {
                    alignment: center;
                    spacing: 4px;
                    
                    Text {
                        text: "MPC Wallet Node";
                        font-size: 24px;
                        font-weight: 700;
                        color: text-primary;
                    }
                    
                    Text {
                        text: "Secure Multi-Party Computation";
                        font-size: 14px;
                        color: text-secondary;
                    }
                }
                
                // Connection Status Badge
                Rectangle {
                    width: 200px;
                    height: 40px;
                    background: AppState.websocket-connected ? rgba(74, 222, 128, 0.1) : rgba(239, 68, 68, 0.1);
                    border-radius: 20px;
                    border-width: 1px;
                    border-color: AppState.websocket-connected ? accent-success : accent-error;
                    
                    HorizontalBox {
                        padding-left: 16px;
                        padding-right: 16px;
                        alignment: center;
                        spacing: 8px;
                        
                        Rectangle {
                            width: 8px;
                            height: 8px;
                            border-radius: 4px;
                            background: AppState.websocket-connected ? accent-success : accent-error;
                            
                            animate background {
                                duration: 300ms;
                                easing: ease-in-out;
                            }
                        }
                        
                        Text {
                            text: AppState.websocket-connected ? "Connected" : "Disconnected";
                            color: AppState.websocket-connected ? accent-success : accent-error;
                            font-size: 14px;
                            font-weight: 500;
                        }
                    }
                }
            }
        }
        
        // Main Content Area
        HorizontalBox {
            spacing: 20px;
            
            // Left Panel - Controls
            Rectangle {
                width: 400px;
                background: bg-secondary;
                border-radius: 12px;
                drop-shadow-blur: 10px;
                drop-shadow-color: rgba(0, 0, 0, 0.2);
                
                VerticalBox {
                    padding: 24px;
                    spacing: 24px;
                    
                    // Device Connection Section
                    VerticalBox {
                        spacing: 16px;
                        
                        Text {
                            text: "Device Connection";
                            font-size: 18px;
                            font-weight: 600;
                            color: text-primary;
                        }
                        
                        VerticalBox {
                            spacing: 12px;
                            
                            Text {
                                text: "Device ID";
                                font-size: 13px;
                                color: text-secondary;
                            }
                            
                            LineEdit {
                                placeholder-text: "Enter your device ID";
                                text <=> AppState.device-id;
                                font-size: 14px;
                                height: 44px;
                                padding: 12px;
                                background: bg-tertiary;
                                border-radius: 8px;
                                border-width: 1px;
                                border-color: border-color;
                                
                                style: {
                                    selection-background-color: accent-primary;
                                    selection-foreground-color: white;
                                    foreground-color: text-primary;
                                    placeholder-foreground-color: text-secondary;
                                }
                            }
                            
                            Button {
                                text: "Connect";
                                font-size: 15px;
                                font-weight: 500;
                                height: 44px;
                                background: accent-primary;
                                border-radius: 8px;
                                clicked => { connect-websocket(AppState.device-id); }
                                
                                style: {
                                    foreground-color: white;
                                    background: accent-primary;
                                }
                            }
                        }
                    }
                    
                    Rectangle { height: 1px; background: border-color; }
                    
                    // DKG Section
                    VerticalBox {
                        spacing: 16px;
                        
                        Text {
                            text: "Key Generation";
                            font-size: 18px;
                            font-weight: 600;
                            color: text-primary;
                        }
                        
                        Text {
                            text: "Session: " + AppState.session-status;
                            font-size: 13px;
                            color: text-secondary;
                            wrap: word-wrap;
                        }
                        
                        Button {
                            text: "Start DKG";
                            font-size: 15px;
                            font-weight: 500;
                            height: 44px;
                            enabled: AppState.websocket-connected;
                            background: AppState.websocket-connected ? accent-primary : bg-tertiary;
                            border-radius: 8px;
                            clicked => { start-dkg(); }
                            
                            style: {
                                foreground-color: AppState.websocket-connected ? white : text-secondary;
                                background: AppState.websocket-connected ? accent-primary : bg-tertiary;
                            }
                        }
                    }
                    
                    // Generated Address Display
                    if AppState.generated-address != "" : VerticalBox {
                        spacing: 12px;
                        
                        Rectangle { height: 1px; background: border-color; }
                        
                        Text {
                            text: "Generated Address";
                            font-size: 14px;
                            font-weight: 600;
                            color: text-primary;
                        }
                        
                        Rectangle {
                            background: bg-tertiary;
                            border-radius: 8px;
                            padding: 16px;
                            
                            Text {
                                text: AppState.generated-address;
                                font-size: 13px;
                                font-family: "monospace";
                                color: accent-success;
                                wrap: word-wrap;
                            }
                        }
                    }
                }
            }
            
            // Right Panel - Logs
            Rectangle {
                background: bg-secondary;
                border-radius: 12px;
                drop-shadow-blur: 10px;
                drop-shadow-color: rgba(0, 0, 0, 0.2);
                
                VerticalBox {
                    padding: 24px;
                    spacing: 16px;
                    
                    HorizontalBox {
                        alignment: space-between;
                        
                        Text {
                            text: "Activity Logs";
                            font-size: 18px;
                            font-weight: 600;
                            color: text-primary;
                        }
                        
                        Text {
                            text: AppState.log-messages.length + " messages";
                            font-size: 13px;
                            color: text-secondary;
                        }
                    }
                    
                    Rectangle {
                        background: bg-primary;
                        border-radius: 8px;
                        border-width: 1px;
                        border-color: border-color;
                        
                        ScrollView {
                            padding: 16px;
                            
                            VerticalBox {
                                spacing: 8px;
                                
                                for log in AppState.log-messages : Rectangle {
                                    background: bg-tertiary;
                                    border-radius: 6px;
                                    padding: 12px;
                                    
                                    Text {
                                        text: log;
                                        font-size: 13px;
                                        font-family: "monospace";
                                        color: text-primary;
                                        wrap: word-wrap;
                                    }
                                }
                                
                                if AppState.log-messages.length == 0 : Text {
                                    text: "No logs yet...";
                                    font-size: 14px;
                                    color: text-secondary;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}