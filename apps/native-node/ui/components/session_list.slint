import { Button, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";

export struct SessionInfo {
    session_id: string,
    initiator: string,
    participants: int,
    threshold: string,
    status: string, // "waiting", "in_progress", "completed"
    created_at: string,
}

export component SessionList inherits Rectangle {
    in property <[SessionInfo]> available_sessions: [];
    in property <SessionInfo> active_session;
    in property <bool> has_active_session: false;
    
    callback join_session(string);
    callback create_session();
    callback leave_session();
    callback refresh_sessions();
    
    preferred-height: 400px;
    background: #16213E;
    border-radius: 8px;
    
    VerticalBox {
        padding: 16px;
        spacing: 16px;
        
        // Header
        HorizontalBox {
            Text {
                text: "Sessions";
                color: white;
                font-size: 16px;
                font-weight: 600;
            }
            
            Rectangle { } // Spacer
            
            Button {
                text: "Create Session";
                enabled: !has_active_session;
                clicked => { create_session(); }
            }
            
            TouchArea {
                width: 32px;
                height: 32px;
                
                Rectangle {
                    border-radius: 6px;
                    background: parent.has-hover ? #334155 : transparent;
                    
                    Text {
                        text: "ðŸ”„";
                        font-size: 16px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                
                clicked => { refresh_sessions(); }
            }
        }
        
        // Active session
        if has_active_session: Rectangle {
            padding: 12px;
            border-radius: 8px;
            background: linear-gradient(135deg, #10B981, #059669);
            
            VerticalBox {
                spacing: 8px;
                
                HorizontalBox {
                    Text {
                        text: "Active Session";
                        color: white;
                        font-size: 14px;
                        font-weight: 600;
                    }
                    
                    Rectangle { } // Spacer
                    
                    TouchArea {
                        width: 60px;
                        height: 24px;
                        
                        Rectangle {
                            border-radius: 4px;
                            background: parent.has-hover ? #DC2626 : #EF4444;
                            
                            Text {
                                text: "Leave";
                                color: white;
                                font-size: 12px;
                                horizontal-alignment: center;
                                vertical-alignment: center;
                            }
                        }
                        
                        clicked => { leave_session(); }
                    }
                }
                
                HorizontalBox {
                    spacing: 16px;
                    
                    Text {
                        text: "ID: " + active_session.session_id;
                        color: rgba(255, 255, 255, 0.9);
                        font-size: 12px;
                    }
                    
                    Text {
                        text: "Threshold: " + active_session.threshold;
                        color: rgba(255, 255, 255, 0.9);
                        font-size: 12px;
                    }
                    
                    Text {
                        text: active_session.participants + " participants";
                        color: rgba(255, 255, 255, 0.9);
                        font-size: 12px;
                    }
                }
            }
        }
        
        // Available sessions
        VerticalBox {
            spacing: 8px;
            
            Text {
                text: "Available Sessions (" + available_sessions.length + ")";
                color: #94A3B8;
                font-size: 14px;
                font-weight: 500;
            }
            
            ScrollView {
                height: 250px;
                
                VerticalBox {
                    spacing: 8px;
                    
                    if available_sessions.length == 0: Rectangle {
                        height: 100px;
                        
                        Text {
                            text: "No sessions available";
                            color: #64748B;
                            font-size: 13px;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                    
                    for session in available_sessions: TouchArea {
                        height: 72px;
                        
                        Rectangle {
                            border-radius: 6px;
                            background: parent.has-hover ? #1E293B : #0F172A;
                            border-width: 1px;
                            border-color: session.status == "in_progress" ? #3B82F6 : #334155;
                            
                            HorizontalBox {
                                padding: 12px;
                                spacing: 12px;
                                
                                // Status indicator
                                Rectangle {
                                    width: 8px;
                                    height: 8px;
                                    border-radius: 4px;
                                    background: session.status == "waiting" ? #F59E0B :
                                               session.status == "in_progress" ? #3B82F6 : #10B981;
                                    vertical-alignment: center;
                                }
                                
                                // Session info
                                VerticalBox {
                                    spacing: 4px;
                                    vertical-alignment: center;
                                    
                                    HorizontalBox {
                                        spacing: 8px;
                                        
                                        Text {
                                            text: session.session_id.length > 12 ? 
                                                  session.session_id.substring(0, 12) + "..." :
                                                  session.session_id;
                                            color: white;
                                            font-size: 13px;
                                            font-weight: 500;
                                        }
                                        
                                        Text {
                                            text: "by " + session.initiator;
                                            color: #64748B;
                                            font-size: 12px;
                                        }
                                    }
                                    
                                    HorizontalBox {
                                        spacing: 12px;
                                        
                                        Text {
                                            text: "ðŸ‘¥ " + session.participants;
                                            color: #94A3B8;
                                            font-size: 11px;
                                        }
                                        
                                        Text {
                                            text: "ðŸ” " + session.threshold;
                                            color: #94A3B8;
                                            font-size: 11px;
                                        }
                                        
                                        Text {
                                            text: session.created_at;
                                            color: #64748B;
                                            font-size: 11px;
                                        }
                                    }
                                }
                                
                                Rectangle { } // Spacer
                                
                                // Join button
                                if !has_active_session && session.status == "waiting": TouchArea {
                                    width: 60px;
                                    height: 28px;
                                    vertical-alignment: center;
                                    
                                    Rectangle {
                                        border-radius: 4px;
                                        background: parent.has-hover ? #2563EB : #3B82F6;
                                        
                                        Text {
                                            text: "Join";
                                            color: white;
                                            font-size: 12px;
                                            font-weight: 500;
                                            horizontal-alignment: center;
                                            vertical-alignment: center;
                                        }
                                    }
                                    
                                    clicked => { join_session(session.session_id); }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}