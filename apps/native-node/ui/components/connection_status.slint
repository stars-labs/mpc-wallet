import { VerticalBox, HorizontalBox, GridBox } from "std-widgets.slint";

export struct ConnectionInfo {
    peer_id: string,
    status: string,
    latency_ms: int,
    quality: float,
}

export component ConnectionStatus inherits Rectangle {
    in property <bool> websocket_connected: false;
    in property <bool> webrtc_connected: false;
    in property <[ConnectionInfo]> mesh_connections: [];
    in property <string> offline_mode: "online"; // "online", "offline", "hybrid"
    
    preferred-height: 120px;
    background: #16213E;
    border-radius: 8px;
    
    VerticalBox {
        padding: 16px;
        spacing: 12px;
        
        // Header
        HorizontalBox {
            Text {
                text: "Network Status";
                color: #94A3B8;
                font-size: 14px;
                font-weight: 600;
            }
            
            Rectangle { } // Spacer
            
            // Mode indicator
            Rectangle {
                width: 80px;
                height: 24px;
                border-radius: 12px;
                background: offline_mode == "offline" ? #EF4444 : 
                           offline_mode == "hybrid" ? #F59E0B : #10B981;
                
                Text {
                    text: offline_mode == "offline" ? "Offline" :
                          offline_mode == "hybrid" ? "Hybrid" : "Online";
                    color: white;
                    font-size: 12px;
                    font-weight: 500;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
        }
        
        // Connection grid
        GridBox {
            Row {
                // WebSocket status
                Rectangle {
                    width: 180px;
                    height: 32px;
                    border-radius: 6px;
                    background: #0F172A;
                    border-width: 1px;
                    border-color: websocket_connected ? #10B981 : #64748B;
                    
                    HorizontalBox {
                        padding-left: 8px;
                        padding-right: 8px;
                        spacing: 8px;
                        
                        Rectangle {
                            width: 8px;
                            height: 8px;
                            border-radius: 4px;
                            background: websocket_connected ? #10B981 : #64748B;
                            vertical-alignment: center;
                        }
                        
                        Text {
                            text: "WebSocket";
                            color: #E2E8F0;
                            font-size: 12px;
                            vertical-alignment: center;
                        }
                        
                        Rectangle { } // Spacer
                        
                        Text {
                            text: websocket_connected ? "Connected" : "Disconnected";
                            color: websocket_connected ? #10B981 : #64748B;
                            font-size: 11px;
                            vertical-alignment: center;
                        }
                    }
                }
                
                // WebRTC status
                Rectangle {
                    width: 180px;
                    height: 32px;
                    border-radius: 6px;
                    background: #0F172A;
                    border-width: 1px;
                    border-color: webrtc_connected ? #10B981 : #64748B;
                    
                    HorizontalBox {
                        padding-left: 8px;
                        padding-right: 8px;
                        spacing: 8px;
                        
                        Rectangle {
                            width: 8px;
                            height: 8px;
                            border-radius: 4px;
                            background: webrtc_connected ? #10B981 : #64748B;
                            vertical-alignment: center;
                        }
                        
                        Text {
                            text: "WebRTC Mesh";
                            color: #E2E8F0;
                            font-size: 12px;
                            vertical-alignment: center;
                        }
                        
                        Rectangle { } // Spacer
                        
                        Text {
                            text: webrtc_connected ? 
                                  mesh_connections.length + " peers" : "Not connected";
                            color: webrtc_connected ? #10B981 : #64748B;
                            font-size: 11px;
                            vertical-alignment: center;
                        }
                    }
                }
                
                // SD Card status (for offline mode)
                if offline_mode != "online": Rectangle {
                    width: 180px;
                    height: 32px;
                    border-radius: 6px;
                    background: #0F172A;
                    border-width: 1px;
                    border-color: #F59E0B;
                    
                    HorizontalBox {
                        padding-left: 8px;
                        padding-right: 8px;
                        spacing: 8px;
                        
                        Rectangle {
                            width: 8px;
                            height: 8px;
                            border-radius: 4px;
                            background: #F59E0B;
                            vertical-alignment: center;
                        }
                        
                        Text {
                            text: "SD Card";
                            color: #E2E8F0;
                            font-size: 12px;
                            vertical-alignment: center;
                        }
                        
                        Rectangle { } // Spacer
                        
                        Text {
                            text: "Ready";
                            color: #F59E0B;
                            font-size: 11px;
                            vertical-alignment: center;
                        }
                    }
                }
            }
        }
    }
}